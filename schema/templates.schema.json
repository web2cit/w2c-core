{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gitlab.wikimedia.org/diegodlh/w2c-core/-/blob/main/templates.schema.json",
  "title": "Domain translation templates configuration for Web2Cit",
  "description": "Each translation template defines translation procedures to extract relevant metadata from a specific template webpage (see https://meta.wikimedia.org/wiki/Web2Cit/Early_adopters#templates.json)",
  "type": "array",
  "items": {
    "title": "Translation template",
    "type": "object",
    "properties": {
      "path": {
        "title": "Path",
        "description": "Path of the webpage used as translation template",
        "options": {
          "infoText": "Do not include the hostname; just the path beginning with \"/\". You may also include query (?) and fragment (#) components. Duplicate translation templates for the same path will be ignored.",
          "patternmessage": "Path must start with \"/\""
        },
        "type": "string",
        "default": "/",
        "pattern": "^\/.*"
      },
      "label": {
        "title": "Label",
        "description": "Fancy name for this translation template",
        "type": "string"
      },
      "fields": {
        "title": "Fields",
        "description": "Each template field defines translation procedures to extract metadata belonging to a specific citation field (see https://meta.wikimedia.org/wiki/Web2Cit/Early_adopters#Translation_field_types)",
        "options": { "infoText": "Mandatory fields \"itemType\" and \"title\" must be included, or template will be ignored. Duplicate template fields with the same field name will be ignored." },
        "type": "array",
        "items": {
          "title": "Template field",
          "oneOf": [
            {
              "title": "Item type field (mandatory)",
              "description": "Type of the cited resource | Valid output: one of the Citoid/Zotero supported types (see https://aurimasv.github.io/z2csl/typeMap.xml)",
              "type": "object",
              "properties": {
                "fieldname": {
                  "title": "Field name",
                  "type": "string",
                  "enum": ["itemType"],
                  "options": { "hidden": true }
                },
                "required": {
                  "$ref": "#/definitions/required"
                },
                "procedures": {
                  "$ref": "#/definitions/procedures",
                  "options": { "infoText": "Fallback \"Item type\" procedure: select \"itemType\" field from Citoid response" },
                  "items": {
                    "$ref": "#/definitions/procedure",
                    "default": {
                      "selections": [
                        {
                          "type": "citoid",
                          "config": "itemType"
                        }
                      ],
                      "transformations": []
                    }
                  }
                }
              },
              "required": [
                "fieldname",
                "required",
                "procedures"
              ]
            },
            {
              "title": "Title field (mandatory)",
              "description": "Title of the cited resource | Valid output: a single non-empty string",
              "type": "object",
              "properties": {
                "fieldname": {
                  "title": "Field name",
                  "type": "string",
                  "enum": ["title"],
                  "options": { "hidden": true }
                },
                "required": {
                  "$ref": "#/definitions/required"
                },
                "procedures": {
                  "$ref": "#/definitions/procedures",
                  "options": { "infoText": "Fallback \"Title\" procedure: select \"title\" field from Citoid response" },
                  "items": {
                    "$ref": "#/definitions/procedure",
                    "default": {
                      "selections": [
                        {
                          "type": "citoid",
                          "config": "title"
                        }
                      ],
                      "transformations": []
                    }
                  }
                }
              },
              "required": [
                "fieldname",
                "required",
                "procedures"
              ]
            },
            {
              "title": "Author last/full names field",
              "description": "Authors' last or full names | Valid output: one or more non-empty strings",
              "type": "object",
              "properties": {
                "fieldname": {
                  "title": "Field name",
                  "type": "string",
                  "enum": ["authorLast"],
                  "options": { "hidden": true }
                },
                "required": {
                  "$ref": "#/definitions/required"
                },
                "procedures": {
                  "$ref": "#/definitions/procedures",
                  "options": { "infoText": "Fallback \"Author last names\" procedure: select \"authorLast\" field from Citoid response" },
                  "items": {
                    "$ref": "#/definitions/procedure",
                    "default": {
                      "selections": [
                        {
                          "type": "citoid",
                          "config": "authorLast"
                        }
                      ],
                      "transformations": []
                    }
                  }
                }
              },
              "required": [
                "fieldname",
                "required",
                "procedures"
              ]
            },
            {
              "title": "Author first names field",
              "description": "Authors' first names | Valid output: one or more empty or non-empty strings",
              "type": "object",
              "properties": {
                "fieldname": {
                  "title": "Field name",
                  "type": "string",
                  "enum": ["authorFirst"],
                  "options": { "hidden": true }
                },
                "required": {
                  "$ref": "#/definitions/required"
                },
                "procedures": {
                  "$ref": "#/definitions/procedures",
                  "options": { "infoText": "Fallback \"Author first names\" procedure: select \"authorFirst\" field from Citoid response" },
                  "items": {
                    "$ref": "#/definitions/procedure",
                    "default": {
                      "selections": [
                        {
                          "type": "citoid",
                          "config": "authorFirst"
                        }
                      ],
                      "transformations": []
                    }
                  }
                }
              },
              "required": [
                "fieldname",
                "required",
                "procedures"
              ]
            },
            {
              "title": "Date field",
              "description": "Publishing date | Valid output: a single yyyy-mm-dd, yyyy-mm or yyyy value",
              "type": "object",
              "properties": {
                "fieldname": {
                  "title": "Field name",
                  "type": "string",
                  "enum": ["date"],
                  "options": { "hidden": true }
                },
                "required": {
                  "$ref": "#/definitions/required"
                },
                "procedures": {
                  "$ref": "#/definitions/procedures",
                  "options": { "infoText": "Falback \"Date\" procedure: select \"date\" field from Citoid response" },
                  "items": {
                    "$ref": "#/definitions/procedure",
                    "default": {
                      "selections": [
                        {
                          "type": "citoid",
                          "config": "date"
                        }
                      ],
                      "transformations": []
                    }
                  }
                }
              },
              "required": [
                "fieldname",
                "required",
                "procedures"
              ]
            },
            {
              "title": "Published in field",
              "description": "Work containing the cited resource | Valid output: a single non-empty string",
              "type": "object",
              "properties": {
                "fieldname": {
                  "title": "Field name",
                  "type": "string",
                  "enum": ["publishedIn"],
                  "options": { "hidden": true }
                },
                "required": {
                  "$ref": "#/definitions/required"
                },
                "procedures": {
                  "$ref": "#/definitions/procedures",
                  "options": { "infoText": "Fallback \"Published in\" procedure: select any of \"publicationTitle\", \"code\" or \"reporter\" fields from Citoid response" },
                  "items": {
                    "$ref": "#/definitions/procedure",
                    "default": {
                      "selections": [
                        {
                          "type": "citoid",
                          "config": "publicationTitle"
                        },
                        {
                          "type": "citoid",
                          "config": "code"
                        },
                        {
                          "type": "citoid",
                          "config": "reporter"
                        }
                      ],
                      "transformations": []
                    }
                  }
                }
              },
              "required": [
                "fieldname",
                "required",
                "procedures"
              ]
            },
            {
              "title": "Published by field",
              "description": "Publisher of the cited resource | Valid output: a single non-empty string",
              "type": "object",
              "properties": {
                "fieldname": {
                  "title": "Field name",
                  "type": "string",
                  "enum": ["publishedBy"],
                  "options": { "hidden": true }
                },
                "required": {
                  "$ref": "#/definitions/required"
                },
                "procedures": {
                  "$ref": "#/definitions/procedures",
                  "options": { "infoText": "Fallback \"Published by\" procedure: select \"publisher\" field from Citoid response" },
                  "items": {
                    "$ref": "#/definitions/procedure",
                    "default": {
                      "selections": [
                        {
                          "type": "citoid",
                          "config": "publisher"
                        }
                      ],
                      "transformations": []
                    }
                  }
                }
              },
              "required": [
                "fieldname",
                "required",
                "procedures"
              ]
            },
            {
              "title": "Language field",
              "description": "Publishing language | Valid output: a single xx or xx-xx* language code",
              "type": "object",
              "properties": {
                "fieldname": {
                  "title": "Field name",
                  "type": "string",
                  "enum": ["language"],
                  "options": { "hidden": true }
                },
                "required": {
                  "$ref": "#/definitions/required"
                },
                "procedures": {
                  "$ref": "#/definitions/procedures",
                  "options": { "infoText": "Fallback \"Language\" procedure: select \"language\" field from Citoid response" },
                  "items": {
                    "$ref": "#/definitions/procedure",
                    "default": {
                      "selections": [
                        {
                          "type": "citoid",
                          "config": "language"
                        }
                      ],
                      "transformations": []
                    }
                  }
                }
              },
              "required": [
                "fieldname",
                "required",
                "procedures"
              ]
            },
            {
              "title": "Control field",
              "description": "Template applicability control | Valid output: a single non-empty string",
              "type": "object",
              "properties": {
                "fieldname": {
                  "title": "Field name",
                  "type": "string",
                  "enum": ["control"],
                  "options": { "hidden": true }
                },
                "required": {
                  "$ref": "#/definitions/required"
                },
                "procedures": {
                  "$ref": "#/definitions/procedures"
                }
              },
              "required": [
                "fieldname",
                "required",
                "procedures"
              ]
            }
          ]
        }
      }
    },
    "required": [
      "path",
      "fields"
    ]
  },
  "definitions": {
    "required": {
      "Title": "Required",
      "description": "Whether the template field is required or not",
      "options": { "infoText": "Given a target webpage, the output of all required fields must be valid for the template to be applicable. Mandatory fields \"itemType\" and \"title\" are always required." },
      "type": "boolean",
      "default": true
    },
    "procedures": {
      "title": "Procedures",
      "description": "Each translation procedure defines a series of selection and transformation steps to extract and manipulate relevant metadata",
      "type": "array"
    },
    "procedure": {
      "title": "Translation procedure",
      "type": "object",
      "properties": {
        "selections": {
          "title": "Selection",
          "description": "Selection steps select and extract individual elements from the target webpage (see https://meta.wikimedia.org/wiki/Web2Cit/Early_adopters#Selection_types_and_configs)",
          "options": { "infoText": "The combined output of all selection steps is given as input to the first transformation step below." },
          "default": [],
          "type": "array",
          "items": {
            "title": "Selection step",
            "anyOf": [
              {
                "title": "Citoid selection",
                "description": "Selects a field from the Citoid response for the target webpage",
                "type": "object",
                "properties": {
                  "type": {
                    "title": "Type",
                    "type": "string",
                    "enum": ["citoid"],
                    "options": { "hidden": true }
                  },
                  "config": {
                    "title": "Configuration",
                    "description": "Any valid Citoid/Zotero base field name; use Wikimedia REST API (\"citation\" endpoint, \"mediawiki-basefields\" format) to check Citoid response for the target webpage: https://en.wikipedia.org/api/rest_v1/#/Citation/getCitation",
                    "options": { "infoText": "Creator fields (e.g., \"author\") are split into creatorFirst and creatorLast fields." },
                    "type": "string",
                    "enum": [
                      "abstractNote",
                      "accessDate",
                      "applicationNumber",
                      "archive",
                      "archiveLocation",
                      "artworkSize",
                      "assignee",
                      "attorneyAgentFirst",
                      "attorneyAgentLast",
                      "authorFirst",
                      "authorLast",
                      "bookAuthorFirst",
                      "bookAuthorLast",
                      "callNumber",
                      "castMemberFirst",
                      "castMemberLast",
                      "code",
                      "codeNumber",
                      "commenterFirst",
                      "commenterLast",
                      "committee",
                      "composerFirst",
                      "composerLast",
                      "conferenceName",
                      "contributorFirst",
                      "contributorLast",
                      "cosponsorFirst",
                      "cosponsorLast",
                      "counselFirst",
                      "counselLast",
                      "country",
                      "court",
                      "date",
                      "DOI",
                      "edition",
                      "editorFirst",
                      "editorLast",
                      "extra",
                      "filingDate",
                      "guestFirst",
                      "guestLast",
                      "history",
                      "interviewerFirst",
                      "interviewerLast",
                      "isbn",
                      "issn",
                      "issue",
                      "issuingAuthority",
                      "itemType",
                      "journalAbbreviation",
                      "language",
                      "legalStatus",
                      "legislativeBody",
                      "libraryCatalog",
                      "medium",
                      "meetingName",
                      "number",
                      "numberOfVolumes",
                      "numPages",
                      "oclc",
                      "pages",
                      "place",
                      "PMCID",
                      "PMID",
                      "priorityNumbers",
                      "producerFirst",
                      "producerLast",
                      "programmingLanguage",
                      "publicationTitle",
                      "publisher",
                      "recipientFirst",
                      "recipientLast",
                      "references",
                      "reporter",
                      "reviewedAuthorFirst",
                      "reviewedAuthorLast",
                      "rights",
                      "runningTime",
                      "scale",
                      "scriptwriterFirst",
                      "scriptwriterLast",
                      "section",
                      "series",
                      "seriesEditorFirst",
                      "seriesEditorLast",
                      "seriesNumber",
                      "seriesText",
                      "seriesTitle",
                      "session",
                      "shortTitle",
                      "system",
                      "tags",
                      "title",
                      "translatorFirst",
                      "translatorLast",
                      "type",
                      "url",
                      "versionNumber",
                      "volume",
                      "wordsByFirst",
                      "wordsByLast"
                    ]
                  }
                },
                "required": [
                  "type",
                  "config"
                ]
              },
              {
                "title": "XPath selection",
                "description": "Selects a node from the target webpage's HTML using XPath",
                "type": "object",
                "properties": {
                  "type": {
                    "title": "Type",
                    "type": "string",
                    "enum": ["xpath"],
                    "options": { "hidden": true }
                  },
                  "config": {
                    "title": "Configuration",
                    "description": "Any valid XPath v1.0 expression",
                    "options": { "infoText": "Your web browser's inspector (shown with F12 in some browsers) may help you get an XPath expression for an HTML node." },
                    "type": "string"
                  }
                },
                "required": [
                  "type",
                  "config"
                ]
              },
              {
                "title": "Fixed selection (Item type field)",
                "description": "Always returns the same predefined Citoid/Zotero item type",
                "type": "object",
                "properties": {
                  "type": {
                    "title": "Type",
                    "type": "string",
                    "enum": ["fixed"],
                    "options": { "hidden": true }
                  },
                  "config": {
                    "title": "Configuration",
                    "description": "The predefined Citoid/Zotero item type to be returned.",
                    "type": "string",
                    "enum": [
                      "artwork",
                      "attachment",
                      "audioRecording",
                      "bill",
                      "blogPost",
                      "book",
                      "bookSection",
                      "case",
                      "computerProgram",
                      "conferencePaper",
                      "dictionaryEntry",
                      "document",
                      "email",
                      "encyclopediaArticle",
                      "film",
                      "forumPost",
                      "hearing",
                      "instantMessage",
                      "interview",
                      "journalArticle",
                      "letter",
                      "magazineArticle",
                      "manuscript",
                      "map",
                      "newspaperArticle",
                      "note",
                      "patent",
                      "podcast",
                      "presentation",
                      "radioBroadcast",
                      "report",
                      "statute",
                      "thesis",
                      "tvBroadcast",
                      "videoRecording",
                      "webpage"
                    ]
                  }
                },
                "required": [
                  "type",
                  "config"
                ]
              },
              {
                "title": "Fixed selection",
                "description": "Always returns the same predefined value",
                "type": "object",
                "properties": {
                  "type": {
                    "title": "Type",
                    "type": "string",
                    "enum": ["fixed"],
                    "options": { "hidden": true }
                  },
                  "config": {
                    "title": "Configuration",
                    "description": "The predefined value to be returned.",
                    "type": "string"
                  }
                },
                "required": [
                  "type",
                  "config"
                ]
              }
            ]
          }
        },
        "transformations": {
          "title": "Transformation",
          "description": "Transformation steps transform selected elements (if needed) to return the expected output (see https://meta.wikimedia.org/wiki/Web2Cit/Early_adopters#Transformation_types_and_configs)",
          "options": { "infoText": "Transformation steps are applied one after the other, and the output of the last transformation step is the procedure's output." },
          "type": "array",
          "items": {
            "title": "Transformation step",
            "oneOf": [
              {
                "title": "Join transformation",
                "description": "Joins two or more items in a list into one, using the separator specified",
                "type": "object",
                "properties": {
                  "type": {
                    "title": "Type",
                    "type": "string",
                    "enum": ["join"],
                    "options": { "hidden": true }
                  },
                  "config": {
                    "title": "Configuration",
                    "description": "The separator to use.",
                    "type": "string"
                  },
                  "itemwise": {
                    "$ref": "#/definitions/itemwise",
                    "options": { "infoText": "default: false (join transformation)" },
                    "default": false
                  }
                },
                "required": [
                  "type",
                  "config",
                  "itemwise"
                ]
              },
              {
                "title": "Split transformation",
                "description": "Splits a string at the separator specified into two or more substrings",
                "type": "object",
                "properties": {
                  "type": {
                    "title": "Type",
                    "type": "string",
                    "enum": ["split"],
                    "options": { "hidden": true }
                  },
                  "config": {
                    "title": "Configuration",
                    "description": "The separator to use.",
                    "type": "string"
                  },
                  "itemwise": {
                    "$ref": "#/definitions/itemwise",
                    "options": { "infoText": "default: true (split transformation)" },
                    "default": true
                  }
                },
                "required": [
                  "type",
                  "config",
                  "itemwise"
                ]
              },
              {
                "title": "Date transformation",
                "description": "Uses the Sugar.js to try and parse natural language dates into the YYYY-MM-DD format",
                "type": "object",
                "properties": {
                  "type": {
                    "title": "Type",
                    "type": "string",
                    "enum": ["date"],
                    "options": { "hidden": true }
                  },
                  "config": {
                    "title": "Configuration",
                    "description": "Any of the currently supported locales",
                    "type": "string",
                    "enum": [
                      "ca",
                      "da",
                      "de",
                      "en",
                      "es",
                      "fi",
                      "fr",
                      "it",
                      "ja",
                      "ko",
                      "nl",
                      "no",
                      "pl",
                      "pt",
                      "ru",
                      "sv",
                      "zh-CN",
                      "zh-TW"
                    ],
                    "options": {
                      "enum_titles": [
                        "Catalan (ca)",
                        "Danish (da)",
                        "German (de)",
                        "English (en)",
                        "Spanish (es)",
                        "Finnish (fi)",
                        "French (fr)",
                        "Italian (it)",
                        "Japanese (ja)",
                        "Korean (ko)",
                        "Dutch (nl)",
                        "Norwegian (no)",
                        "Polish (pl)",
                        "Portuguese (pt)",
                        "Russian (ru)",
                        "Swedish (sv)",
                        "Chinese (zh-CN)",
                        "Chinese (zh-TW)"
                      ]
                    }
                  },
                  "itemwise": {
                    "$ref": "#/definitions/itemwise",
                    "options": { "infoText": "default: true (date transformation)" },
                    "default": true
                  }
                },
                "required": [
                  "type",
                  "config",
                  "itemwise"
                ]
              },
              {
                "title": "Range transformation",
                "description": "Returns one or more items or ranges of items in the order specified",
                "type": "object",
                "properties": {
                  "type": {
                    "title": "Type",
                    "type": "string",
                    "enum": ["range"],
                    "options": { "hidden": true }
                  },
                  "config": {
                    "title": "Configuration",
                    "description": "One or more comma-separated ranges: \"start(:end)\", \"start:\" or \":end\".",
                    "options": { "infoText": "Ranges use one-based numbering, meaning that the first item is item 1" },
                    "type": "string"
                  },
                  "itemwise": {
                    "$ref": "#/definitions/itemwise",
                    "options": { "infoText": "default: false (range transformation)" },
                    "default": false
                  }
                },
                "required": [
                  "type",
                  "config",
                  "itemwise"
                ]
              },
              {
                "title": "Match transformation",
                "description": "Returns one or more substrings matching a target",
                "type": "object",
                "properties": {
                  "type": {
                    "title": "Type",
                    "type": "string",
                    "enum": ["match"],
                    "options": { "hidden": true }
                  },
                  "config": {
                    "title": "Configuration",
                    "description": "The matching target, expressed as either plain string or /regular expression/ (see https://meta.wikimedia.org/wiki/Web2Cit/Early_adopters#Match_transformation).",
                    "type": "string"
                  },
                  "itemwise": {
                    "$ref": "#/definitions/itemwise",
                    "options": { "infoText": "default: true (match transformation)" },
                    "default": true
                  }
                },
                "required": [
                  "type",
                  "config",
                  "itemwise"
                ]
              }
            ]
          }
        }
      },
      "required": [
        "selections",
        "transformations"
      ]
    },
    "itemwise": {
      "title": "Item-wise",
      "description": "Whether transformation should be applied to each item of the input independently (true) or to the entire input as a whole (false).",
      "type": "boolean"
    }
  }
}